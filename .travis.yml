sudo: required
language: php
dist: xenial
group: edge

services:
  - docker

php:
  - 7.2
  - 7.3
  - nightly

branches:
  only:
    - master
    - develop

matrix:
  include:
    - env: LINT=1
      php: 7.3
    - env: COVERAGE=1
      php: 7.3

  allow_failures:
    - php: nightly

install:
  - composer self-update

before_script:
  - cp .env.testing .env
  - phpenv config-rm xdebug.ini
  - composer self-update
  - composer install --no-interaction
  - docker pull arangodb/arangodb:latest
  - docker run -d -p 8529:8529 -e ARANGO_ROOT_PASSWORD=testing arangodb/arangodb:latest
  - docker ps -a
  - sleep 30

script:
  - vendor/bin/phpunit -c phpunit.xml --coverage-clover=coverage.xml

after_success:
  - bash <(curl -s https://codecov.io/bash)

notifications:
  email:
    on_success: change
    on_failure: always
